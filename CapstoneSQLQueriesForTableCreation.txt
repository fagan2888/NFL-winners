##### The below query creates the home_game_stats table #####

create table ALL_HOME_GAME_STATS as (

select CAST(sum(passing_yards) AS INT) as passing_yards, 
CAST(sum(rushing_yards) AS INT) as rushing_yards,
CAST(sum(passing_interceptions) AS INT) as turnovers_given, 
CAST(sum(defense_interceptions) AS INT) as turnovers_taken,
player_team_score, opponent_score,
game_id, team, game_won, game_location, season_year from player_logs 
where season_year > 2001 and game_location='H'
group by game_id, player_team_score, opponent_score, team, game_won, game_location, season_year )

##################################################################################################

##### The below query creates the away_game_stats table #####

create table ALL_AWAY_GAME_STATS as (

select CAST(sum(passing_yards) AS INT) as passing_yards, 
CAST(sum(rushing_yards) AS INT) as rushing_yards,
CAST(sum(passing_interceptions) AS INT) as turnovers_given, 
CAST(sum(defense_interceptions) AS INT) as turnovers_taken,
player_team_score, opponent_score,
game_id, team, game_won, game_location, season_year from player_logs 
where season_year > 2001 and game_location='A'
group by game_id, player_team_score, opponent_score, team, game_won, game_location, season_year )

###################################################################################################

##### The below query creates the HOME_GAMES table #####

create table HOME_GAMES AS (
select
ALL_HOME_GAME_STATS.season_year as season_year,
ALL_HOME_GAME_STATS.game_id as game_id,
ALL_HOME_GAME_STATS.game_location as game_location,
ALL_HOME_GAME_STATS.game_date as game_date,
ALL_HOME_GAME_STATS.team as team,
ALL_AWAY_GAME_STATS.team as opp_team,
ALL_HOME_GAME_STATS.player_team_score as team_score,
ALL_HOME_GAME_STATS.opponent_score as opponent_score,
ALL_HOME_GAME_STATS.passing_yards as team_passing_yards,
ALL_HOME_GAME_STATS.rushing_yards as team_rushing_yards,
ALL_HOME_GAME_STATS.turnovers_taken as team_turnovers_taken,
ALL_HOME_GAME_STATS.turnovers_given as team_turnovers_given,
ALL_AWAY_GAME_STATS.passing_yards as opp_passing_yards,
ALL_AWAY_GAME_STATS.rushing_yards as opp_rushing_yards,
ALL_AWAY_GAME_STATS.turnovers_taken as opp_turnovers_taken,
ALL_AWAY_GAME_STATS.turnovers_given as opp_turnovers_given,
ALL_HOME_GAME_STATS.game_won as outcome
from ALL_HOME_GAME_STATS
INNER JOIN ALL_AWAY_GAME_STATS ON ALL_HOME_GAME_STATS.game_id=ALL_AWAY_GAME_STATS.game_id)

######################################################################################################

##### The below query creates the AWAY_GAMES_table #####

create table HOME_GAMES AS (
select
ALL_AWAY_GAME_STATS.season_year as season_year,
ALL_AWAY_GAME_STATS.game_id as game_id,
ALL_AWAY_GAME_STATS.game_location as game_location,
ALL_AWAY_GAME_STATS.game_date as game_date,
ALL_AWAY_GAME_STATS.team as team,
ALL_HOME_GAME_STATS.team as opp_team,
ALL_AWAY_GAME_STATS.player_team_score as team_score,
ALL_AWAY_GAME_STATS.opponent_score as opponent_score,
ALL_AWAY_GAME_STATS.passing_yards as team_passing_yards,
ALL_AWAY_GAME_STATS.rushing_yards as team_rushing_yards,
ALL_AWAY_GAME_STATS.turnovers_taken as team_turnovers_taken,
ALL_AWAY_GAME_STATS.turnovers_given as team_turnovers_given,
ALL_HOME_GAME_STATS.passing_yards as opp_passing_yards,
ALL_HOME_GAME_STATS.rushing_yards as opp_rushing_yards,
ALL_HOME_GAME_STATS.turnovers_taken as opp_turnovers_taken,
ALL_HOME_GAME_STATS.turnovers_given as opp_turnovers_given,
ALL_AWAY_GAME_STATS.game_won as outcome
from ALL_AWAY_GAME_STATS
INNER JOIN ALL_HOME_GAME_STATS ON ALL_AWAY_GAME_STATS.game_id=ALL_HOME_GAME_STATS.game_id)

########################################################################################################

##### The below query creates the ALL_GAMES table #####

create table ALL_GAMES as (

select * from HOME_GAMES
union
	select * from AWAY_GAMES
)

##########################################################################################################

##### The below query will create the instances table ####


create table instances as (
select home_games_all.game_location as team_1_location,
	home_games_all.score_for as team_1_score,
	home_games_all.score_against as team_1_opp_score, 
	home_games_all.team_passing_yards as team_1_passing_yards,
	home_games_all.team_rushing_yards as team_1_rushing_yards, 
	home_games_all.team_passing_yards_against as team_1_opp_passing_yards,
	home_games_all.team_rushing_yards_against as team_1_opp_rushing_yards, 
	home_games_all.team_turnovers_taken as team_1_turnovers,
	home_games_all.team_turnovers_given as team_1_opp_turnovers, 
	home_games_all.team_win_percentage as team_1_win_percent,
	home_games_all.outcome as outcome,
	away_games_all.game_location as team_0_location, 
	away_games_all.score_for as team_0_score,
	away_games_all.score_against as team_0_opp_score, 
	away_games_all.team_passing_yards as team_0_passing_yards,
	away_games_all.team_rushing_yards as team_0_rushing_yards, 
	away_games_all.team_passing_yards_against as team_0_opp_passing_yards,
	away_games_all.team_rushing_yards_against as team_0_opp_rushing_yards, 
	away_games_all.team_turnovers_taken as team_0_turnovers,
	away_games_all.team_turnovers_given as team_0_opp_turnovers, 
	away_games_all.team_win_percentage as team_0_win_percent
	from home_games_all
	INNER JOIN away_games_all ON home_games_all.game_id=away_games_all.game_id)